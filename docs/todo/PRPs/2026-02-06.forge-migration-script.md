name: "Forge Migration Script - Backup/Transfer/Restore Laravel Sites"
description: |

## Purpose
Implement a bash script (bashew-based) to migrate a Laravel website with all its data
from one Laravel Forge-managed server to another. Uses a backup/restore strategy with
a password-protected zip file as the transport mechanism.

## Core Principles
1. **Context is King**: Include ALL necessary documentation, examples, and caveats
2. **Validation Loops**: Provide executable tests/lints the AI can run and fix
3. **Information Dense**: Use keywords and patterns from the codebase
4. **Progressive Success**: Start simple, validate, then enhance
5. **Global rules**: Be sure to follow all rules in CLAUDE.md

---

## Goal
Build `migrate_forge.sh` with three main verbs:
- **backup**: Run on source server - packs .env, database dump, and storage/app into a password-protected zip
- **restore**: Run on destination server - prompts for password, unzips, restores .env, database, and storage/app
- **setup**: Uses Laravel Forge API to create the site on the new server, install git repo, configure deployment script, and request SSL certificate
- **wizard**: Interactive guided migration - picks servers from ~/.ssh/config, lists sites, asks what to include, then outputs a step-by-step migration plan with exact commands

## Why
- Migrating Laravel sites between Forge servers is a common but error-prone manual process
- A single zip file as transport is simple, secure (password-protected), and auditable
- Separating data migration (backup/restore) from infrastructure setup (Forge API) keeps concerns clean
- Works across different server providers as long as both are Forge-managed

## What

### User-visible behavior

**`migrate_forge backup`** (run on source server via SSH):
1. Detects the Laravel project root (looks for artisan file)
2. Dumps the MySQL database using mysqldump (credentials from .env)
3. Copies the .env file (excluding server-dependent vars like DB_HOST, REDIS_HOST, etc.)
4. Copies the storage/app folder only (not logs/cache/sessions)
5. Creates a manifest file with metadata (domain, PHP version, git remote, timestamp)
6. Zips everything into a password-protected archive
7. Outputs the path to the zip file

**`migrate_forge restore`** (run on destination server via SSH):
1. Prompts for the password
2. Extracts the zip file
3. Smart .env merge:
   - Variables only in backup: add to current .env
   - Variables only in current .env: keep as-is
   - Same value in both: keep as-is
   - Different value: prompt user, default = keep current .env value
4. Imports the MySQL database dump
5. Restores storage/app folder (backs up existing first)
6. Runs `php artisan config:cache` and `php artisan migrate`
7. Sets correct file permissions (forge:forge, 775)

**`migrate_forge setup`** (run from any machine with Forge API access):
1. Creates a new site on the destination server via Forge API
2. Installs the git repository (same repo/branch as source)
3. Copies the deployment script from the source site
4. Triggers initial deployment
5. Requests Let's Encrypt SSL certificate

### Success Criteria
- [ ] `backup` creates a valid password-protected zip with .env, db dump, storage/app, and manifest
- [ ] `restore` correctly restores all components from the zip
- [ ] `setup` creates a functional site on the destination server via Forge API
- [ ] Script follows bashew conventions (IO:debug, IO:print, IO:die, Os:require, etc.)
- [ ] Script handles MySQL databases (mysqldump for backup, mysql for restore)
- [ ] Script validates prerequisites before starting each action
- [ ] `bash -n migrate_forge.sh` passes (syntax check)
- [ ] `shellcheck migrate_forge.sh` passes with no errors (warnings acceptable)

## All Needed Context

### Documentation & References
```yaml
- url: https://forge.laravel.com/docs/api-reference/introduction
  why: "Forge API authentication: Bearer token, base URL https://forge.laravel.com/api, required headers Accept/Content-Type application/json"

- url: https://forge.laravel.com/api-documentation
  why: |
    Current v1 API endpoints (works until March 2026):
    - GET /api/v1/servers - list servers
    - GET /api/v1/servers/{id} - get server
    - GET /api/v1/servers/{serverId}/sites - list sites
    - GET /api/v1/servers/{serverId}/sites/{siteId} - get site
    - POST /api/v1/servers/{serverId}/sites - create site (params: domain, project_type, aliases, directory, php_version, database)
    - POST /api/v1/servers/{serverId}/sites/{siteId}/git - install repository (params: provider, repository, branch, composer)
    - GET /api/v1/servers/{serverId}/sites/{siteId}/deployment/script - get deployment script
    - PUT /api/v1/servers/{serverId}/sites/{siteId}/deployment/script - update deployment script (params: content)
    - GET /api/v1/servers/{serverId}/sites/{siteId}/env - get .env file
    - PUT /api/v1/servers/{serverId}/sites/{siteId}/env - update .env file (params: content)
    - POST /api/v1/servers/{serverId}/sites/{siteId}/certificates/letsencrypt - request Let's Encrypt cert (params: domains array)
    - GET /api/v1/servers/{serverId}/sites/{siteId}/nginx - get nginx config
    - PUT /api/v1/servers/{serverId}/sites/{siteId}/nginx - update nginx config (params: content)
    - POST /api/v1/servers/{serverId}/sites/{siteId}/deployment/deploy - trigger deployment

- url: https://forge.laravel.com/docs/cli
  why: |
    Forge CLI commands (alternative to API, requires PHP):
    - forge env:pull example.com .env - download .env
    - forge env:push example.com .env - upload .env
    - forge deploy example.com - trigger deployment
    - forge ssh server-name - SSH into server
    - forge command example.com --command="php artisan ..." - run remote command

- url: https://spatie.be/docs/laravel-backup/v9/taking-backups/overview
  why: |
    Alternative for database backup (if spatie/laravel-backup is installed):
    - php artisan backup:run --only-db - backup only database
    - Creates zip at: <app-name>/<Y-m-d-H-i-s>.zip
    User suggested using this package for db backup/restore

- file: migrate_forge.sh
  why: |
    This is the bashew-based script to modify. Key patterns:
    - Option:config() defines flags/options/params/choices
    - Script:main() dispatches to verb functions via case statement
    - Helper functions like do_action1() implement the verbs
    - IO:print/debug/die/success/alert for output
    - Os:require "binary" ["package"] for dependency checking
    - Os:tempfile [ext] for temp files
    - $TMP_DIR and $LOG_DIR are auto-managed
    - .env files are auto-loaded from script folder and cwd
```

### Current Codebase tree
```
migrate_forge/
├── .git/
├── .claude/
├── .idea/
└── migrate_forge.sh          # main bashew script (only file)
```

### Desired Codebase tree
```
migrate_forge/
├── .git/
├── .claude/
├── docs/
│   └── todo/
│       └── PRPs/
│           └── 2026-02-06.forge-migration-script.md  # this PRP
├── migrate_forge.sh          # main script with all verbs implemented
└── .env.example              # example config with FORGE_API_TOKEN etc.
```

### Known Gotchas & Caveats
```bash
# CRITICAL: zip password protection
# Use `zip -e -P "$password"` for encryption, but password on CLI is visible in `ps`
# Better: use `zip -e` which prompts for password interactively
# Or: use `7z a -p"$password" -mhe=on` for AES-256 encryption (stronger)
# Decision: use zip with interactive password prompt for backup, prompt for restore

# CRITICAL: Database detection
# Parse .env for DB_CONNECTION (mysql|pgsql|sqlite)
# Parse DB_HOST, DB_PORT, DB_DATABASE, DB_USERNAME, DB_PASSWORD
# MySQL: mysqldump --single-transaction --routines --triggers
# PostgreSQL: pg_dump --format=custom (or plain SQL with pg_dump --format=plain)
# Restore: mysql < dump.sql / pg_restore or psql < dump.sql

# CRITICAL: Large storage folders
# storage/app can be huge. Use rsync-style progress or warn user about size
# zip compression helps but may still be large

# CRITICAL: File permissions after restore
# Laravel needs: storage/ and bootstrap/cache/ writable by web server
# chown -R www-data:www-data storage bootstrap/cache (or forge:forge on Forge servers)
# chmod -R 775 storage bootstrap/cache

# CRITICAL: Forge API rate limiting
# API returns 429 if too many requests. Add small delays between API calls.

# CRITICAL: .env differences between servers
# Source .env may have different DB credentials, Redis host, queue driver, etc.
# Restore should warn user to review/update the .env after restoring

# GOTCHA: The script itself needs to run ON the servers for backup/restore
# but FROM any machine for the setup verb (which only uses the API)
# So backup/restore need: zip/unzip, mysql/mysqldump or pg_dump/pg_restore
# And setup needs: curl, jq (for JSON parsing)
```

## Implementation Blueprint

### Data models and structure

The migration archive (zip file) contains:
```
migrate_DOMAIN_YYYY-MM-DD.zip
├── manifest.json          # metadata about the migration
├── dotenv                 # the .env file (renamed to avoid issues)
├── database.sql           # database dump (MySQL or PostgreSQL)
└── storage/               # storage/app folder contents
    └── app/
        ├── public/
        └── ...
```

**manifest.json structure:**
```json
{
  "domain": "example.com",
  "created_at": "2026-02-06T12:00:00Z",
  "script_version": "0.0.1",
  "laravel_version": "11.x",
  "php_version": "8.3",
  "db_connection": "mysql",
  "db_database": "example_db",
  "git_remote": "git@github.com:user/repo.git",
  "git_branch": "main",
  "storage_size_mb": 450,
  "source_server": "server-name",
  "project_root": "/home/forge/example.com"
}
```

### Options/flags to add to Option:config()

```bash
# Replace the current Option:config choices and add new options:
flag|h|help|show usage
flag|Q|QUIET|no output
flag|V|VERBOSE|also show debug messages
flag|f|FORCE|do not ask for confirmation (always yes)
option|L|LOG_DIR|folder for log files|$HOME/log/$script_prefix
option|T|TMP_DIR|folder for temp files|/tmp/$script_prefix
option|d|domain|website domain name
option|s|server|Forge server ID or name
option|r|root|Laravel project root folder|.
option|o|output|output zip file path
choice|1|action|action to perform|backup,restore,setup,check,env,update
param|?|input|input file/text
```

### List of tasks to be completed

```yaml
Task 1: Update Option:config() with new options and verbs
  MODIFY migrate_forge.sh:
  - UPDATE the Option:config() function to add: domain, server, root, output options
  - UPDATE the choice line to: backup,restore,setup,check,env,update
  - KEEP existing flags (help, QUIET, VERBOSE, FORCE)

Task 2: Update Script:main() case statement with new verbs
  MODIFY migrate_forge.sh:
  - REPLACE action1/action2/action3 case blocks with backup/restore/setup
  - ADD TIP comments for each verb
  - KEEP check/env/update verbs as-is
  - ADD Os:require calls at the top for common dependencies

Task 3: Implement do_backup() function
  MODIFY migrate_forge.sh:
  - REPLACE do_action1() with do_backup()
  - Detect Laravel project root (find artisan file)
  - Parse .env for database credentials and app metadata
  - Create temp working directory
  - Dump database (MySQL: mysqldump, PostgreSQL: pg_dump)
  - Copy .env file as "dotenv"
  - Copy storage/app folder
  - Generate manifest.json with metadata
  - Create password-protected zip archive (prompt for password)
  - Report the output file path and size
  - Clean up temp directory

Task 4: Implement do_restore() function
  MODIFY migrate_forge.sh:
  - REPLACE do_action2() with do_restore()
  - Verify input zip file exists
  - Prompt for zip password
  - Extract to temp directory
  - Read and display manifest.json
  - Ask for confirmation to proceed
  - Detect target Laravel project root
  - Restore .env file (with backup of existing)
  - Parse new .env for database credentials
  - Import database dump (mysql or pg_restore/psql)
  - Restore storage/app folder (with backup of existing)
  - Fix file permissions (forge:forge ownership, 775 on storage)
  - Run php artisan config:cache and php artisan migrate
  - Clean up temp directory

Task 5: Implement do_setup() function
  MODIFY migrate_forge.sh:
  - ADD do_setup() function
  - Os:require "curl" and "jq"
  - Read FORGE_API_TOKEN from environment or .env
  - Verify API access with a test call (GET /api/v1/servers)
  - Accept source server ID + site ID (or domain lookup)
  - Accept destination server ID
  - GET source site details (domain, PHP version, etc.)
  - GET source deployment script
  - GET source git repository info
  - CREATE new site on destination server
  - INSTALL git repository on new site
  - UPDATE deployment script on new site
  - DEPLOY the site
  - REQUEST Let's Encrypt SSL certificate
  - Report results

Task 6: Implement helper functions
  MODIFY migrate_forge.sh:
  - ADD parse_dotenv() - parse .env file for a specific key
  - ADD detect_project_root() - find Laravel root (artisan file)
  - ADD forge_api() - wrapper for Forge API calls with auth header
  - ADD dump_mysql() - mysqldump with proper flags
  - ADD dump_pgsql() - pg_dump with proper flags
  - ADD restore_mysql() - mysql import
  - ADD restore_pgsql() - psql/pg_restore import
  - ADD create_manifest() - generate manifest.json
  - ADD read_manifest() - parse manifest.json

Task 7: Create .env.example
  CREATE .env.example with:
  - FORGE_API_TOKEN=
  - FORGE_SOURCE_SERVER=
  - FORGE_SOURCE_SITE=
  - FORGE_DEST_SERVER=

Task 8: Validation and testing
  - Run: bash -n migrate_forge.sh
  - Run: shellcheck migrate_forge.sh
  - Run: ./migrate_forge.sh check
  - Run: ./migrate_forge.sh --help
  - Fix any issues found
```

### Per-task pseudocode

#### Task 3: do_backup() pseudocode
```bash
function do_backup() {
  # 1. Find Laravel root
  local project_root
  project_root=$(detect_project_root "${root}")
  [[ ! -f "${project_root}/artisan" ]] && IO:die "No Laravel project found at [${project_root}]"

  # 2. Parse .env
  local env_file="${project_root}/.env"
  [[ ! -f "${env_file}" ]] && IO:die "No .env file found at [${env_file}]"
  local db_connection db_host db_port db_database db_username db_password
  db_connection=$(parse_dotenv "${env_file}" "DB_CONNECTION")
  db_database=$(parse_dotenv "${env_file}" "DB_DATABASE")
  # ... etc for all DB_ vars
  local app_name domain_name
  app_name=$(parse_dotenv "${env_file}" "APP_NAME")

  # 3. Determine domain from option or .env APP_URL
  [[ -z "${domain}" ]] && domain=$(parse_dotenv "${env_file}" "APP_URL" | sed 's|https\?://||')

  # 4. Create temp working dir
  local work_dir
  work_dir=$(Os:tempfile "d")  # or use mktemp -d
  mkdir -p "${work_dir}"

  # 5. Dump database
  IO:announce "Dumping ${db_connection} database [${db_database}]..."
  case "${db_connection}" in
    mysql)  dump_mysql "${db_host}" "${db_port}" "${db_database}" "${db_username}" "${db_password}" "${work_dir}/database.sql" ;;
    pgsql)  dump_pgsql "${db_host}" "${db_port}" "${db_database}" "${db_username}" "${db_password}" "${work_dir}/database.sql" ;;
    sqlite) cp "${project_root}/database/${db_database}" "${work_dir}/database.sqlite" ;;
    *)      IO:die "Unsupported database connection [${db_connection}]" ;;
  esac

  # 6. Copy .env
  cp "${env_file}" "${work_dir}/dotenv"

  # 7. Copy storage/app
  if [[ -d "${project_root}/storage/app" ]]; then
    IO:announce "Copying storage/app folder..."
    cp -r "${project_root}/storage/app" "${work_dir}/storage_app"
  fi

  # 8. Create manifest
  create_manifest "${work_dir}/manifest.json" "${domain}" "${db_connection}" "${db_database}" "${project_root}"

  # 9. Create password-protected zip
  local zip_name
  zip_name="${output:-migrate_${domain}_$(date +%Y-%m-%d).zip}"
  IO:announce "Creating encrypted zip archive..."
  Os:require "zip"
  (cd "${work_dir}" && zip -r -e "${zip_name}" manifest.json dotenv database.* storage_app/ 2>/dev/null)
  # zip -e prompts for password interactively
  mv "${work_dir}/${zip_name}" "./${zip_name}"

  # 10. Report
  local size
  size=$(du -h "./${zip_name}" | cut -f1)
  IO:success "Backup created: ./${zip_name} (${size})"

  # 11. Cleanup
  rm -rf "${work_dir}"
}
```

#### Task 4: do_restore() pseudocode
```bash
function do_restore() {
  local zip_file="${input}"
  [[ -z "${zip_file}" ]] && IO:die "Usage: $script_prefix restore <zipfile>"
  [[ ! -f "${zip_file}" ]] && IO:die "File not found: [${zip_file}]"

  # 1. Extract (will prompt for password)
  Os:require "unzip"
  local work_dir
  work_dir=$(mktemp -d)
  IO:announce "Extracting archive (enter password when prompted)..."
  unzip "${zip_file}" -d "${work_dir}" || IO:die "Failed to extract - wrong password?"

  # 2. Read manifest
  [[ ! -f "${work_dir}/manifest.json" ]] && IO:die "Invalid archive - no manifest.json found"
  read_manifest "${work_dir}/manifest.json"
  IO:print "Migration from: ${manifest_domain} (${manifest_db_connection})"
  IO:print "Created: ${manifest_created_at}"

  # 3. Confirm
  IO:confirm "Proceed with restore?" || IO:die "Aborted by user"

  # 4. Detect project root
  local project_root
  project_root=$(detect_project_root "${root}")

  # 5. Restore .env (backup existing first)
  if [[ -f "${project_root}/.env" ]]; then
    cp "${project_root}/.env" "${project_root}/.env.backup.$(date +%Y%m%d%H%M%S)"
    IO:debug "Existing .env backed up"
  fi
  cp "${work_dir}/dotenv" "${project_root}/.env"
  IO:alert "IMPORTANT: Review and update .env for new server (DB credentials, Redis, etc.)"

  # 6. Restore database
  local db_connection db_host db_port db_database db_username db_password
  # parse from the RESTORED .env (user should update DB creds first if different)
  # OR parse from manifest and ask user
  IO:announce "Restoring database..."
  case "${manifest_db_connection}" in
    mysql)  restore_mysql ... ;;
    pgsql)  restore_pgsql ... ;;
    sqlite) cp "${work_dir}/database.sqlite" "${project_root}/database/" ;;
  esac

  # 7. Restore storage/app
  if [[ -d "${work_dir}/storage_app" ]]; then
    IO:announce "Restoring storage/app..."
    [[ -d "${project_root}/storage/app" ]] && mv "${project_root}/storage/app" "${project_root}/storage/app.backup.$(date +%Y%m%d%H%M%S)"
    cp -r "${work_dir}/storage_app" "${project_root}/storage/app"
  fi

  # 8. Fix permissions
  IO:announce "Fixing permissions..."
  chown -R forge:forge "${project_root}/storage" "${project_root}/bootstrap/cache" 2>/dev/null || true
  chmod -R 775 "${project_root}/storage" "${project_root}/bootstrap/cache"

  # 9. Laravel cache/migrate
  (cd "${project_root}" && php artisan config:cache && php artisan migrate --force)

  # 10. Cleanup
  rm -rf "${work_dir}"
  IO:success "Restore complete for ${manifest_domain}"
}
```

#### Task 5: do_setup() pseudocode
```bash
function do_setup() {
  Os:require "curl"
  Os:require "jq"

  # 1. Get API token
  local api_token="${FORGE_API_TOKEN:-}"
  [[ -z "${api_token}" ]] && IO:die "FORGE_API_TOKEN not set - add to .env or export"

  # 2. Determine source and destination
  local source_server="${FORGE_SOURCE_SERVER:-${server:-}}"
  local dest_server="${FORGE_DEST_SERVER:-}"
  [[ -z "${source_server}" ]] && IO:die "Source server not specified (--server or FORGE_SOURCE_SERVER)"
  [[ -z "${dest_server}" ]] && IO:die "Destination server not specified (FORGE_DEST_SERVER)"

  # 3. Find source site by domain
  local source_site_id
  source_site_id=$(forge_api GET "/api/v1/servers/${source_server}/sites" \
    | jq -r ".sites[] | select(.name == \"${domain}\") | .id")
  [[ -z "${source_site_id}" ]] && IO:die "Site [${domain}] not found on server [${source_server}]"

  # 4. Get source site details
  local site_info deploy_script
  site_info=$(forge_api GET "/api/v1/servers/${source_server}/sites/${source_site_id}")
  deploy_script=$(forge_api GET "/api/v1/servers/${source_server}/sites/${source_site_id}/deployment/script")

  local repository branch php_version project_type directory
  repository=$(echo "${site_info}" | jq -r '.site.repository')
  branch=$(echo "${site_info}" | jq -r '.site.repository_branch')
  # ... etc

  # 5. Create site on destination
  IO:announce "Creating site [${domain}] on server [${dest_server}]..."
  local new_site
  new_site=$(forge_api POST "/api/v1/servers/${dest_server}/sites" \
    "{\"domain\":\"${domain}\",\"project_type\":\"php\",\"php_version\":\"${php_version}\",\"directory\":\"/public\"}")
  local new_site_id
  new_site_id=$(echo "${new_site}" | jq -r '.site.id')

  # 6. Install git repository
  IO:announce "Installing repository [${repository}] branch [${branch}]..."
  forge_api POST "/api/v1/servers/${dest_server}/sites/${new_site_id}/git" \
    "{\"provider\":\"github\",\"repository\":\"${repository}\",\"branch\":\"${branch}\",\"composer\":true}"

  # 7. Update deployment script
  IO:announce "Updating deployment script..."
  forge_api PUT "/api/v1/servers/${dest_server}/sites/${new_site_id}/deployment/script" \
    "{\"content\":$(echo "${deploy_script}" | jq -Rs)}"

  # 8. Deploy
  IO:announce "Triggering deployment..."
  forge_api POST "/api/v1/servers/${dest_server}/sites/${new_site_id}/deployment/deploy" ""

  # 9. Request SSL
  IO:announce "Requesting Let's Encrypt SSL certificate..."
  forge_api POST "/api/v1/servers/${dest_server}/sites/${new_site_id}/certificates/letsencrypt" \
    "{\"domains\":[\"${domain}\"]}"

  IO:success "Site setup complete on server [${dest_server}]"
  IO:print "Next steps:"
  IO:print "  1. SSH into new server and run: $script_prefix restore <zipfile>"
  IO:print "  2. Update .env on new server with correct credentials"
  IO:print "  3. Update DNS to point ${domain} to new server IP"
}
```

### Integration Points
```yaml
ENVIRONMENT VARIABLES (in .env or exported):
  - FORGE_API_TOKEN: Laravel Forge API bearer token (required for setup)
  - FORGE_SOURCE_SERVER: Source server ID in Forge (for setup)
  - FORGE_SOURCE_SITE: Source site ID in Forge (optional, can lookup by domain)
  - FORGE_DEST_SERVER: Destination server ID in Forge (for setup)

DEPENDENCIES:
  backup:
    - zip (for creating password-protected archive)
    - mysqldump or pg_dump (for database dump)
    - jq (for creating manifest.json)

  restore:
    - unzip (for extracting archive)
    - mysql or psql (for database import)
    - jq (for reading manifest.json)
    - php (for artisan commands)

  setup:
    - curl (for Forge API calls)
    - jq (for JSON parsing)
```

## Validation Loop

### Level 1: Syntax & Style
```bash
# Run these FIRST - fix any errors before proceeding
bash -n migrate_forge.sh          # Syntax check - must pass with zero errors
shellcheck migrate_forge.sh       # Static analysis - fix errors, warnings acceptable

# Expected: No errors. If errors, READ the error and fix.
```

### Level 2: Smoke Tests
```bash
# These should all work without any server access:
./migrate_forge.sh --help              # Should show usage with all verbs
./migrate_forge.sh check               # Should show all options/flags with defaults
./migrate_forge.sh env > .env.example  # Should generate valid .env template

# Test that each verb is reachable (will fail with missing deps, but shouldn't crash):
./migrate_forge.sh backup --help 2>&1 | head -5   # Should not show "action not recognized"
```

### Level 3: Functional Tests (require a Laravel project)
```bash
# On a server with a Laravel project:
cd /home/forge/example.com
/path/to/migrate_forge.sh backup -d example.com

# On the destination server:
/path/to/migrate_forge.sh restore migrate_example.com_2026-02-06.zip

# From any machine with API access:
FORGE_API_TOKEN=xxx /path/to/migrate_forge.sh setup -d example.com -s 12345
```

## Final Validation Checklist
- [ ] `bash -n migrate_forge.sh` passes
- [ ] `shellcheck migrate_forge.sh` has no errors (warnings OK)
- [ ] `./migrate_forge.sh --help` shows all verbs and options correctly
- [ ] `./migrate_forge.sh check` runs without errors
- [ ] All three verbs (backup, restore, setup) are dispatched correctly in case statement
- [ ] Helper functions parse_dotenv, detect_project_root, forge_api are implemented
- [ ] Database support for both MySQL and PostgreSQL
- [ ] Password prompt works for both zip creation and extraction
- [ ] manifest.json is created/read correctly with jq
- [ ] .env.example created with all needed variables documented
- [ ] No hardcoded paths or credentials in the script

---

## Anti-Patterns to Avoid
- Do NOT put passwords on the command line (visible in `ps`) - use interactive prompts or read from stdin
- Do NOT use `eval` for parsing .env - use grep/awk to extract individual values safely
- Do NOT assume MySQL - always check DB_CONNECTION from .env
- Do NOT overwrite existing files without backup - always create .backup.timestamp copies
- Do NOT skip error checking on API calls - check HTTP status codes
- Do NOT store FORGE_API_TOKEN in the script - always read from environment/.env
- Do NOT modify the bashew boilerplate below the "DO NOT MODIFY" line
- Do NOT create separate files - everything goes in migrate_forge.sh (bashew convention)

---

## Confidence Score: 8/10

High confidence because:
- Clear separation of concerns (backup/restore/setup)
- Well-defined data format (zip with manifest)
- Standard tools (zip, mysqldump, curl, jq)
- Bashew framework handles all the boilerplate

Risks:
- Large storage/app folders may take a long time to zip/transfer
- Database dump format compatibility between MySQL versions
- Forge API v1 deprecation (March 2026) - may need migration to new API
- Edge cases: SQLite databases, custom storage disks, multi-database setups
